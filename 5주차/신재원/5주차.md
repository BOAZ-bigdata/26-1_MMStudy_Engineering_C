🏢 분산 DB 예시: "잔고 이체 합의"두 대의 DB 서버($P1, P2$)가 있고, 사용자가 잔고 100원을 A에게 보낼지(결정 0), B에게 보낼지(결정 1) 요청을 보낸 상황을 가정해 봅시다.

1. 초기 상태: Bivalent (결정 전의 혼돈)사용자의 요청이 두 서버에 각각 다르게 전달되었거나, 서버들이 각자 "나는 A가 맞다고 봐", "나는 B가 맞다고 봐"라고 제안한 상태입.
2.
3. 상황: $P1$은 A를 지지, $P2$는 B를 지지합니다.아직은 시스템 전체적으로 A로 결정될 수도, B로 결정될 수도 있는 가능성이 공존합니다. 이 상태가 바로 Bivalent입니다.
4.만약 초기부터 무조건 A로만 결정되어야 한다면($Univalent$), 이는 반대편 서버의 제안을 무시하는 꼴이 되어 합의 알고리즘의 유효성(Validity)에 어긋납니다.
  

결정적 이벤트의 부재 

이제 한 서버가 메시지를 처리해서 "그래, A로 확정하자!"라고 하려는 순간을 봅시다.

시나리오: $P1$이 $P2$에게 "A로 하자"라는 메시지를 보냈습니다. 이 메시지가 도달하면 시스템은 **Univalent(0으로 확정)**가 되어야 합니다.

FLP: 하지만 비동기 네트워크에서는 이 메시지가 무한히 늦게 도착할 수 있습니다.그 사이 P2는 메시지를 못 받았으니 "아직 결정 안 됐네?"라며 자기 마음대로 B를 처리하려고 시도할 수 있다.

$P1$이 보낸 메시지 하나가 도착하느냐 마느냐에 따라 전체 결론이 확 뒤집혀야 한다면, 네트워크 지연(Asynchronous) 상황에서 시스템은 "이게 진짜 확정된 건가, 아니면 그냥 메시지가 늦는 건가?"를 구분할 방법이 없다.

3. 무한 루프: "눈치 게임의 무한 반복"DB 스케줄러가 아주 악의적이라고 가정해 봅시다. P1이 결정을 내리려 하면 스케줄러가 $P1$으로 가는 메시지를 뒤로 미룬다.
  
6. 그동안 $P2$가 다른 결정을 내리려 하면 다시 그 메시지를 미룬다.
7.
8. 이 과정에서 프로세스 하나가 죽은 건지(), 아니면 단순히 느린 건지 알 수 없기 때문에 나머지 프로세스들은 **"얘가 올 때까지 기다려야 하나? 아니면 우리끼리 결정해야 하나?"**라는 딜레마에 빠집니다.
9.
10.
   결국, 시스템은 어느 쪽으로도 확정하지 못하고 bivalent한 상태(결정 유보 상태)를 유지하며 뱅글뱅글 돌게 됩니다.


   결론: DB 엔지니어에게 주는 교훈이 증명이 "당연해 보이는 말" 같지만, 실제 DB 설계에서는 매우 치명적인 결론을 줍니다.

   완벽한 합의는 없다: 비동기 네트워크에서 Liveness(언젠가는 결정됨)와 Safety(잘못된 결정 안 함)를 동시에 완벽히 만족하면서 Fault-tolerance(장애 허용)까지 갖추는 것은 불가능하다는 뜻입니다.

   타임아웃의 도입: 그래서 실제 DB(MySQL Group Replication, MongoDB, Raft 등)는 FLP 정리를 우회하기 위해 **"타임아웃"**이나 "Randomized Delay" 같은 개념을 넣는다.

   (즉, 비동기성을 포기하고 "어느 시간까지 안 오면 죽은 걸로 간주하겠다"는 제약을 추가하는 것.)


   group_replication_member_expel_timeout (추방 타임아웃)
이 설정이 FLP 정리에서 말하는 **"지연(Case 1)과 장애(Case 2)의 구분"**을 결정하는 핵심 변수입니다.

기본 작동: 한 멤버가 다른 멤버로부터 5초 동안 응답을 받지 못하면 '의심(Suspicion)' 상태로 전환합니다.

타임아웃의 역할: 이 '의심' 상태가 시작된 후, member_expel_timeout에 설정된 시간(초)만큼 더 기다립니다.

FLP와의 관계: 이 시간이 지나면 MySQL은 "이 노드는 장애가 발생했다"고 단정하고 그룹에서 추방(Expel)합니다. 만약 이 값이 너무 짧으면 단순 네트워크 지연인데도 노드가 쫓겨나는 일이 잦아지고, 너무 길면 진짜 죽은 노드 때문에 전체 합의가 지연(Bivalent 상태 지속)될 수 있습니다.

2. consensus_election_timeout (선출 타임아웃)
이 값은 리더(Primary)가 사라졌을 때 새로운 리더를 뽑는 과정에 관여합니다.

역할: 리더 노드로부터 하트비트가 오지 않을 때, 새로운 리더를 선출하기 위한 투표를 시작하기까지 기다리는 시간입니다.

설정값: 기본값은 대개 5초 내외로 설정됩니다. 이 타이머가 작동함으로써 "리더가 죽었는지 아닌지 모르는" 혼란스러운 Bivalent 상태를 강제로 종료하고, 새로운 리더를 선출하는 Univalent 상태로 넘어가게 됩니다.

3. group_replication_auto_rejoin_tries (자동 재가입 시도)
추방된 노드가 스스로 다시 합류하려고 시도하는 횟수입니다.

의미: FLP 상황에서 일시적인 네트워크 순단(Case 1)으로 인해 억울하게 추방된 노드가 있다면, 수동 개입 없이 다시 정상 상태로 복귀할 수 있게 돕는 안전장치입니다.
